"use strict";var _COMPONENT_REGISTERED=[];const _LIMIT_=[1,5,10];function generateKampretComponent(){_COMPONENT_REGISTERED=[];const t=$("Component");let e=[];if(t.length<=0)return;$.each(t,(function(t,a){const l=$(this).data("labeloptions"),n=$(this).data("valueoptions");let o=[];if(null!=l&&null!=n){const t=l.split("_OPTSPACE_"),e=n.split("_OPTSPACE_");for(let a=0;a<t.length;++a)null!=t[a]&&null!=e[a]&&""!=t[a]&&""!=e[a]&&o.push({value:e[a],label:t[a]})}e.push({el:$(this).data("element"),rules:$(this).data("rules"),options:o,inputName:$(this).attr("name"),defaultValue:$(this).attr("defaultValue"),label:$(this).attr("label"),readonly:$(this).attr("readonly")}),$(this).html("<p>Generating component...</p>")}));let a=[];$.each(e,(function(t,e){a.push(e.el)})),$.ajax({url:"/component/getComponentByElement",type:"POST",data:{field_names:a},success:function(t){t&&$.each(e,(function(e,a){let l=$('Component[name="'+a.inputName+'"]'),n={index:e,page:1,limit:5,keywords:"",totalData:0,totalPage:0,attributes:{name:"",rules:a?.rules,options:a?.options,defaultValue:a?.defaultValue,label:a?.label,readonly:a?.readonly,length:"",type:"",description:"",master_lookup:"",lookup_type:"",lookup_table:"",lookup_key:"",lookup_desc:""},custom_attributes:{name:a.inputName}};$.each($.parseJSON(t),(function(t,e){a.el==e.name&&(n.attributes.name=e.name,n.attributes.length=e.data_length,n.attributes.type=e.data_type,n.attributes.description=e.field_description?e.field_description:"Undefined Label",n.attributes.master_lookup=e.master_lookup,n.attributes.lookup_type=e.lookup_type,n.attributes.lookup_table=e.lookup_table,n.attributes.lookup_key=e.lookup_key,n.attributes.lookup_desc=e.lookup_desc)})),""!=n.attributes.name&&(_COMPONENT_REGISTERED.push(n),_generateInput(l,e))}))}})}function _generateInput(t=null,e=0){const a=_COMPONENT_REGISTERED[e],l=a.attributes;let n=null!=l?.readonly?"readonly":"";const o="date"==l?.type?.toLowerCase()?"_datepickerDynamic":"";""!=o&&(n="readonly"),"integer"==l?.type?.toLowerCase()&&(l.type="number"),"string"!=l?.type?.toLowerCase()&&"date"!=l?.type?.toLowerCase()||(l.type="text"),"encrypt"==l?.type?.toLowerCase()&&(l.type="password");var i="";"hidden"==l?.type?.toLowerCase()?(i+='<input type="hidden" name="'+a?.custom_attributes?.name+'" id="_inpt_'+a?.custom_attributes?.name+'" value="'+l?.defaultValue+'" />',$(t).replaceWith(i)):"lookup"==l?.lookup_type&&""!=l?.lookup_table?(null!=l?.label&&""!=l?.label&&(i+="<label>"+l?.label+"</label>"),i+='<div class="input-group" style="margin-bottom:17px">',i+='<input data-rules="'+l?.rules+'" readonly class="form-control" type="'+l?.type+'" name="'+a?.custom_attributes?.name+'" id="_inpt_'+a?.custom_attributes?.name+'" maxlength="'+l?.length+'" value="'+l?.defaultValue+'" />',i+='<span style="cursor:pointer" onclick="_openModalLookup(\''+a?.custom_attributes?.name+'\')" class="input-group-text"><i class="fa fa-search"></i></span>',i+="</div>",i+='<div class="modal fade" id="_mdl_'+a?.custom_attributes?.name+'">',i+='<div class="modal-dialog modal-lg" role="document">',i+='<div class="modal-content">',i+='<div class="modal-header">',i+='<h4 class="modal-title">Looking up to table '+l?.lookup_table+"</h4>",i+='<button type="button" class="close" data-dismiss="modal" aria-label="Close">',i+='<span aria-hidden="true">&times;</span>',i+='<span class="sr-only">Close</span>',i+="</button>",i+="</div>",i+='<div class="modal-body">',i+='<div class="row">',i+='<div class="col-sm-2">',i+='<div class="form-group">',i+='<select class="form-control" id="_lookupTotalData" onchange="_doChangeTotalData(\''+e+"')\">",$.each(_LIMIT_,(function(t,e){i+="<option "+(e==a.limit?"selected":"")+' value="'+e+'">'+e+"</option>"})),i+="</select>",i+="</div>",i+="</div>",i+='<div class="col-sm-6">',i+='<p id="_lookupLoading" style="margin-bottom:0;margin-left:20px;text-align:center"></p>',i+="</div>",i+='<div class="col-sm-4">',i+='<div class="form-group" style="float:right">',i+='<input type="text" class="form-control" id="_lookupSearchBox" placeholder="Search.." onkeyup="_doSearchLookUp(\''+e+"')\" />",i+="</div>",i+="</div>",i+="</div>",i+='<div class="table-responsive">',i+='<table class="table table-bordered table-hover">',i+="<thead>",i+="<tr>",i+='<th style="width:5%">#</th>',i+='<th style="width:25%">'+l?.lookup_key?.toUpperCase()+"</th>",i+="<th>"+l?.lookup_desc?.toUpperCase()+"</th>",i+='<th style="width:5%">Actions</th>',i+="</tr>",i+="</thead>",i+='<tbody id="appendDataFor_'+a?.custom_attributes?.name+'"></tbody>',i+="</table>",i+='<nav style="margin-top:20px;float:right;margin-right:10px">',i+='<ul class="pagination" id="_appendListPaginations'+a?.custom_attributes?.name+'"></ul>',i+="</nav>",i+="</div>",i+="</div>",i+="<br />",i+="</div>",i+="</div>",i+="</div>",$(t).replaceWith(i),_generateDataTable(e)):"searchbox"==l?.lookup_type&&""!=l?.lookup_table?(i+='<div class="form-group">',null!=l?.label&&""!=l?.label&&(i+="<label>"+l?.label+"</label>"),i+='<input data-rules="'+l?.rules+'" type="text" autocomplete="off" class="form-control" name="'+a?.custom_attributes?.name+'" id="_inpt_'+a?.custom_attributes?.name+'" '+n+' value="'+l?.defaultValue+'" onfocus="_openSearchBox(this,\''+a?.custom_attributes?.name+"','"+e+"')\" onkeyup=\"_doSearchBox(this,'"+a?.custom_attributes?.name+"','"+e+"')\">",i+="</div>",$(t).replaceWith(i)):"options"==l?.type?.toLowerCase()?(i+='<div class="form-group">',null!=l?.label&&""!=l?.label&&(i+="<label>"+l?.label+"</label>"),i+='<select class="form-control" name="'+a?.custom_attributes?.name+'" id="_inpt_'+a?.custom_attributes?.name+'" '+n+">",null!=l?.options&&l.options.map(((t,e)=>{i+="<option "+(l?.defaultValue?.toLowerCase()==t?.value?.toLowerCase()?"selected":"")+' value="'+t?.value+'">'+t?.label+"</option>"})),i+="</select>",i+="</div>",$(t).replaceWith(i)):(i+='<div class="form-group">',null!=l?.label&&""!=l?.label&&(i+="<label>"+l?.label+"</label>"),i+='<input data-rules="'+l?.rules+'" class="form-control '+o+'" type="'+l?.type+'" name="'+a?.custom_attributes?.name+'" id="_inpt_'+a?.custom_attributes?.name+'" '+n+' maxlength="'+l?.length+'" value="'+l?.defaultValue+'" />',i+="</div>",$(t).replaceWith(i)),""!=o&&$("._datepickerDynamic").datepicker({format:"yyyy-mm-dd",todayHighlight:!0,autoclose:!0})}function _openModalLookup(t=null){$("#_mdl_"+t).modal("show")}function _generateDataTable(t=0){const e=_COMPONENT_REGISTERED[t],a=e.attributes,l=e.page,n=e.limit,o=e.keywords;$("#_lookupLoading").html("Loading.."),$.ajax({url:"/component/getDataDynamicFromDynamicInput?page="+l+"&limit="+n+"&keywords="+o,type:"POST",data:a,cache:!1,success:function(n){const o=$.parseJSON(n);var i="";$.each(o.data,(function(t,l){i+="<tr>",i+="<td>"+(t+1)+"</td>",i+="<td>"+l[a?.lookup_key]+"</td>",i+="<td>"+l[a?.lookup_desc]+"</td>",i+="<td>",i+='<button type="button" onclick="_chooseLookup(\''+e?.custom_attributes?.name+"','"+l[a?.lookup_key]+'\')" class="btn btn-primary btn-block">Choose</button>',i+="</td>",i+="</tr>"})),$("#appendDataFor_"+e?.custom_attributes?.name).html(i),_COMPONENT_REGISTERED[t].totalData=o.totalData,_COMPONENT_REGISTERED[t].totalPage=o.totalPage;var s="";s+="<li onclick=\"_changePageLookup('"+t+'\',\'previous\')" class="page-item"><a class="page-link" href="#">Previous</a></li>',l>5&&(s+="<li onclick=\"_changePageLookup('"+t+'\',1)" class="page-item '+(1==parseInt(l)?"active":"")+'"><a class="page-link" href="#">1</a></li>',s+='<li class="page-item"><a class="page-link" href="#">...</a></li>');for(var r=1;r<=o.totalPage;++r)(l<=5&&r<=5||l>5&&r>5&&r<o.totalPage)&&(s+="<li onclick=\"_changePageLookup('"+t+"','"+r+'\')" class="page-item '+(r==parseInt(l)?"active":"")+'"><a class="page-link" href="#">'+r+"</a></li>");o.totalPage>6&&(l<6&&(s+='<li class="page-item"><a class="page-link" href="#">...</a></li>'),s+="<li onclick=\"_changePageLookup('"+t+"','"+o.totalPage+'\')" class="page-item '+(o.totalPage==parseInt(l)?"active":"")+'"><a class="page-link" href="#">'+o.totalPage+"</a></li>"),s+="<li onclick=\"_changePageLookup('"+t+'\',\'next\')" class="page-item"><a class="page-link" href="#">Next</a></li>',$("#_appendListPaginations"+e?.custom_attributes?.name).html(s),$("#_lookupLoading").html("")}})}function _doSearchLookUp(t=0){const e=$("#_lookupSearchBox").val().toLowerCase();_COMPONENT_REGISTERED[t].page=1,_COMPONENT_REGISTERED[t].keywords=e,_generateDataTable(t)}function _doChangeTotalData(t=0){const e=$("#_lookupTotalData").val().toLowerCase();_COMPONENT_REGISTERED[t].page=1,_COMPONENT_REGISTERED[t].limit=e,_generateDataTable(t)}function _changePageLookup(t=0,e=1){let a=!1;if("next"==e||"previous"==e){let l=parseInt(_COMPONENT_REGISTERED[t].page);const n=parseInt(_COMPONENT_REGISTERED[t].totalPage);"next"==e&&l<n&&(++l,a=!0),"previous"==e&&l>1&&(--l,a=!0),e=l}else a=!0;a&&(_COMPONENT_REGISTERED[t].page=e,_generateDataTable(t))}function _chooseLookup(t,e){$("#_inpt_"+t).val(e),$("#_mdl_"+t).modal("hide")}function _openSearchBox(t=null,e="",a=0){var l='<ul class="_kampretSearchboxList" id="_kampretSearchboxList'+e+'"></ul>';$(document).mouseup((function(t){const a=$("#_kampretSearchboxList"+e),l=$("#_inpt_"+e);a.is(t.target)||0!==a.has(t.target).length||l.is(t.target)||0!==l.has(t.target).length||a.remove()})),$(t).after(l),_doSearchBox(t,e,a)}function _doSearchBox(t=null,e="",a=0){const l=_COMPONENT_REGISTERED[a].attributes;$("#_kampretSearchboxList"+e).html("<li><center>Loading..</center></li>");const n=$(t).val().toLowerCase();$.ajax({url:"/component/getDataDynamicFromDynamicInput?page=1&limit=10&keywords="+n,type:"POST",data:l,cache:!1,success:function(t){const a=$.parseJSON(t);var n="";$.each(a.data,(function(t,a){n+="<li onclick=\"_chooseFromSearchBox(this,'"+e+"','"+a[l?.lookup_key]+"')\">"+a[l?.lookup_desc]+"</li>"})),$("#_kampretSearchboxList"+e).html(n)}})}function _chooseFromSearchBox(t=null,e="",a=""){$("#_inpt_"+e).val(a),$("#_kampretSearchboxList"+e).remove()}function _generateDetailInput(t={},e=""){const a=Math.floor(100*Math.random()+1);let l="",n="",o="",i="",s="",r="";if(null!=t?.validationBeforeOpen){const e=t?.validationBeforeOpen;null!=e?.inputValidation&&""!=e?.inputValidation&&(o=e?.inputValidation),null!=e?.serverValidation&&""!=e?.serverValidation&&(i=e?.serverValidation),null!=e?.errorCallback&&""!=e?.errorCallback&&(s=e?.errorCallback),null!=e?.successCallback&&""!=e?.successCallback&&(r=e?.successCallback)}$.each(t?.fields,(function(t,e){l+=`${e?.fieldName}_SPACE_`,n+=`${e?.fieldType}_SPACE_`}));var u='<p id="_btnOpenDetailKampret'+e+'" onclick="_openDetailKampret(\''+a+"','"+o+"','"+i+"','"+s+"','"+e+"','"+l+"','"+n+"','"+r+"','"+t?.storageName+'\')" style="float: right;cursor:pointer;background-color:blue;color: white; padding: 5px 10px; border-radius: 5px;">'+(null!=t?.detailLabel?t?.detailLabel:"View Detail")+"</p>";return u+='<div id="_boxTableKampretId-'+a+'" class="table-responsive hide" style="display: none">',u+="<legend>"+t?.detailLabel+"</legend>",u+='<table class="table table-bordered">',u+="<thead>",u+="<tr>",$.each(t?.fields,(function(t,e){u+="<th>"+e?.fieldLabel+"</th>"})),u+='<th style="width:5%">Actions</th>',u+="</tr>",u+="</thead>",u+='<tbody id="_tableContentKampretId-'+a+'">',u+="<tr>",u+='<td colspan="'+(t?.fields?.length+1)+'">',u+="<button onclick=\"_addRowInTableKampret('"+l+"', '"+n+"', '"+a+"','"+t?.storageName+'\')" type="button" style="padding:3px 5px" class="btn btn-sm btn-primary btn-rounded"><i class="fa fa-plus"></i></button>',u+="</td>",u+="</tr>",u+="</tbody>",u+="</table>",u+="</div>"}function _generateKampretForm(t={}){$.each(t?.components,(function(e,a){(null==a.column||a.column<=0||a.column>6)&&(t.components[e].column=1)}));var e='<div class="row" id="_mainFormKampret'+t?.formName+'">';const a=t?.columns>0?Math.ceil(12/t.columns):12;for(let l=1;l<=t?.columns;++l)e+='<div class="col-'+a+'">',$.each(t?.components,(function(t,a){if(a?.column==l){const t=null!=a?.defaultValue?a?.defaultValue:"",l=null!=a?.inputName?a?.inputName:"_undefinedName_";null!=a?.componentId&&(e+='<Component label="'+a?.inputLabel+'" data-element="'+a?.componentId+'" name="'+l+'" defaultValue="'+t+'"></Component>'),null!=a?.detail&&(e+=_generateDetailInput(a?.detail,l))}})),e+="</div>";if(e+="</div>",$.each(t?.buttons,(function(a,l){null!=l?.next&&null!=l?.next?.steps&&$.each(l?.next?.steps,(function(a,l){e+='<div class="row" id="_mainFormKampret'+t?.formName+"steps"+(a+2)+'" style="display:none">';const n=l?.columns>0?Math.ceil(12/l?.columns):12;for(let t=1;t<=l?.columns;++t)e+='<div class="col-'+n+'">',$.each(l?.components,(function(a,l){if(l?.column==t){const t=null!=l?.defaultValue?l?.defaultValue:"",a=null!=l?.inputName?l?.inputName:"_undefinedName_";null!=l?.componentId&&(e+='<Component label="'+l?.inputLabel+'" data-element="'+l?.componentId+'" name="'+a+'" defaultValue="'+t+'"></Component>')}})),e+="</div>";e+="</div>"}))})),e+=_generateKampretButtons(t?.buttons,t?.showAlertConfimation,t?.components,t?.formName),null!=t?.formAction){var l='<form action="'+t?.formAction+'" id="_myKampretForm'+t?.formName+'" method="POST">';l+=e,l+="</form>"}else l=e;return t?.components?.length>0&&generateKampretComponent(),l}function _generateKampretButtons(t=[],e=!1,a=[],l=""){var n="";$.each(a,(function(t,e){n+=e?.inputName+"_SPACE_"})),$.each(t,(function(t,e){null!=e?.next&&$.each(e?.next?.steps,(function(t,e){null!=e?.components&&$.each(e?.components,(function(t,e){n+=e?.inputName+"_SPACE_"}))}))}));var o="<hr />";return o+='<div class="row">',o+='<div class="col-12">',$.each(t,(function(t,a){let i="button";a.type=a?.type?.toLowerCase(),null==a?.type&&"submit"!=a?.type&&"href"!=a?.type&&"print"!=a?.type||(i=a?.type);let s="btn btn-primary";null!=a?.class&&(s=a?.class);let r="Save";null!=a?.text&&(r=a?.text);let u="/";null!=a?.buttonAction&&(u=a?.buttonAction),null!=a?.next&&null!=a?.next?.steps&&(u="",$.each(a?.next?.steps,(function(t,e){null!=e?.buttonAction&&(u+=e?.buttonAction+"_SPACE_")})));let c=_toSlug(r),p=a?.next?.steps?.length;if(null==p&&(p=0),"submit"==i){let t="";e&&(t="onclick=\"return confirm('Are you sure?')\""),o+='<button style="margin-right:10px" id="_btnKampret'+c+'" type="'+i+'" '+t+' class="'+s+'">'+r+"</button>"}else o+="print"==i?'<button style="margin-right:10px" id="_btnKampret'+c+'" type="button" onclick="_printAction(\''+n+"','"+c+"','"+r+'\')" class="'+s+'">'+r+"</button>":"logic"==i?'<button style="margin-right:10px" id="_btnKampret'+c+'" type="button" onclick="_logicAction(\''+n+"','"+u+"','"+c+"','"+r+"','"+l+"','"+p+'\')" class="'+s+'">'+r+"</button>":'<a style="margin-right:10px" id="_btnKampret'+c+'" href="'+u+'" class="'+s+'">'+r+"</a>"})),o+="</div>",o+="</div>"}function _toSlug(t=""){let e=t.replace(/ /g,"-");return e=e.replace(/,/g,"-"),e.toLowerCase()}function _getDataFromString(t=""){const e=t.split("_SPACE_");let a=[];return $.each(e,(function(t,e){""!=e&&null!=e&&e&&a.push({field_name:e,field_value:$("#_inpt_"+e).val()})})),a}function _printAction(t="",e=null,a=""){let l=_getDataFromString(t);if(l.length>0){window.open("/component/print")._componentKampretData=l}}$((function(){generateKampretComponent()}));var _stepPosition=1;function _logicAction(t="",e="",a=null,l="",n="",o=0){let i=_getDataFromString(t),s={};$.each(i,(function(t,e){s[e.field_name]=e.field_value}));let r=!1;(o<=0||o>0&&_stepPosition<=o)&&(r=!0);let u=e.split("_SPACE_");$.each(u,(function(t,a){_stepPosition==t+1&&a&&(e=a)})),r&&$("#_btnKampret"+a).attr("disabled",!0).html("Loading..."),parseInt(o)>0&&parseInt(o)+1==_stepPosition?$("#_myKampretForm"+n).submit():$.ajax({url:e,type:"POST",data:s,cache:!1,success:function(t){let e=$.parseJSON(t),i="";null!=e?.errorMessages&&e?.errorMessages?.length>0&&($.each(e?.errorMessages,(function(t,e){i+=e+"<br />"})),setMessage("Something went wrong","warning",i)),_stepPosition<=o&&""==i&&($("#_mainFormKampret"+n).hide(),$("#_mainFormKampret"+n+"steps"+_stepPosition).hide(),++_stepPosition,$("#_mainFormKampret"+n+"steps"+_stepPosition).show()),$.each(s,(function(t,a){null!=e[t]&&$('input[name="'+t+'"]').val(e[t])})),$("#_btnKampret"+a).attr("disabled",!1).html(l)}})}function _validateInput(t=[],e=""){let a=[];return t.map(((t,l)=>{if("required"==t)""!=e&&e||a.push("Field is required!");else{const l=t.split("=");null!=l[0]&&null!=l[1]&&("max-length"==l[0]?.toLowerCase()?e?.length>l[1]&&a.push("Max input character is "+l[1]):"min-length"==l[0]?.toLowerCase()&&e?.length<l[1]&&a.push("Min input character is "+l[1]))}})),a}async function _openDetailKampret(t="",e="",a="",l="",n="",o="",i="",s="",r=""){const u=$('input[name="'+n+'"]'),c=$(u).val(),p=$("#_btnOpenDetailKampret"+n),d=$(p).text();let m=[];if(""!=e){const t=e.split("|");m=_validateInput(t,c)}if(""!=a&&$("#_boxTableKampretId-"+t).hasClass("hide")){let e={};e[n]=c,e.fields=o.split("_SPACE_"),$(u).attr("disabled",!0),$(p).attr("disabled",!0).text("Loading..."),await $.ajax({url:a,type:"POST",data:e,success:function(e){$(u).attr("disabled",!1),$(p).attr("disabled",!1).text(d),null!=(e=$.parseJSON(e))[l]?m.push(e[l]):null!=e[s]&&e[s].map(((e,a)=>{_addRowInTableKampret(o,i,t,r,e)}))}})}if(m.length>0){let e="";return m.map(((t,a)=>{e+=`${t} <br />`})),setMessage("Something went wrong","warning",e),void $("#_boxTableKampretId-"+t).hide().removeClass("show").addClass("hide")}$("#_boxTableKampretId-"+t).hasClass("hide")&&$("#_boxTableKampretId-"+t).show().removeClass("hide").addClass("show")}function _addRowInTableKampret(t="",e="",a="",l=null,n={}){const o=t.split("_SPACE_"),i=e.split("_SPACE_"),s=Math.floor(99999*Math.random()+1),r=$("#_tableContentKampretId-"+a),u="_tableContentKampretId-"+a+"-row-"+s;l=null!=l&&l?l:s;let c='<tr id="'+u+'">';$.each(o,(function(t,e){if(""!=e){var a=null!=i[t]&&"number"==i[t]?"number":"text";c+="<td>",c+='<input type="'+a+'" class="form-control" name="'+l+"["+e+'][]" placeholder="'+e+'" value="'+(null!=n[e]?n[e]:"")+'" />',c+="</td>"}})),c+="<td>",c+='<button type="button" onclick="_removeElementById(\''+u+'\')" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i></button>',c+="</td>",c+="</tr>",$(r).prepend(c)}function _removeElementById(t=null){t&&$("#"+t).remove()}